{"ast":null,"code":"import _regeneratorRuntime from \"D:/projects/react/wen-base/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\n/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { isNullish } from 'web3-validator';\nimport { Eip1559NotSupportedError, UnsupportedTransactionTypeError } from 'web3-errors';\nimport { format } from 'web3-utils';\n// eslint-disable-next-line import/no-cycle\nimport { getBlock, getGasPrice } from '../rpc_method_wrappers.js';\n// eslint-disable-next-line import/no-cycle\nimport { getTransactionType } from './transaction_builder.js';\nfunction getEip1559GasPricing(transaction, web3Context, returnFormat) {\n  var _a, _b, _c;\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n    var block, convertedTransactionGasPrice;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) switch (_context.prev = _context.next) {\n        case 0:\n          _context.next = 2;\n          return getBlock(web3Context, web3Context.defaultBlock, false, returnFormat);\n        case 2:\n          block = _context.sent;\n          if (!isNullish(block.baseFeePerGas)) {\n            _context.next = 5;\n            break;\n          }\n          throw new Eip1559NotSupportedError();\n        case 5:\n          if (isNullish(transaction.gasPrice)) {\n            _context.next = 8;\n            break;\n          }\n          convertedTransactionGasPrice = format({\n            format: 'uint'\n          }, transaction.gasPrice, returnFormat);\n          return _context.abrupt(\"return\", {\n            maxPriorityFeePerGas: convertedTransactionGasPrice,\n            maxFeePerGas: convertedTransactionGasPrice\n          });\n        case 8:\n          return _context.abrupt(\"return\", {\n            maxPriorityFeePerGas: format({\n              format: 'uint'\n            }, (_a = transaction.maxPriorityFeePerGas) !== null && _a !== void 0 ? _a : web3Context.defaultMaxPriorityFeePerGas, returnFormat),\n            maxFeePerGas: format({\n              format: 'uint'\n            }, (_b = transaction.maxFeePerGas) !== null && _b !== void 0 ? _b : BigInt(block.baseFeePerGas) * BigInt(2) + BigInt((_c = transaction.maxPriorityFeePerGas) !== null && _c !== void 0 ? _c : web3Context.defaultMaxPriorityFeePerGas), returnFormat)\n          });\n        case 9:\n        case \"end\":\n          return _context.stop();\n      }\n    }, _callee);\n  }));\n}\nexport function getTransactionGasPricing(transaction, web3Context, returnFormat) {\n  return __awaiter(this, void 0, void 0, /*#__PURE__*/_regeneratorRuntime().mark(function _callee2() {\n    var transactionType;\n    return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n      while (1) switch (_context2.prev = _context2.next) {\n        case 0:\n          transactionType = getTransactionType(transaction, web3Context);\n          if (isNullish(transactionType)) {\n            _context2.next = 20;\n            break;\n          }\n          if (!transactionType.startsWith('-')) {\n            _context2.next = 4;\n            break;\n          }\n          throw new UnsupportedTransactionTypeError(transactionType);\n        case 4:\n          if (!(transactionType < '0x0' || transactionType > '0x7f')) {\n            _context2.next = 6;\n            break;\n          }\n          throw new UnsupportedTransactionTypeError(transactionType);\n        case 6:\n          if (!(isNullish(transaction.gasPrice) && (transactionType === '0x0' || transactionType === '0x1'))) {\n            _context2.next = 13;\n            break;\n          }\n          _context2.next = 9;\n          return getGasPrice(web3Context, returnFormat);\n        case 9:\n          _context2.t0 = _context2.sent;\n          _context2.t1 = undefined;\n          _context2.t2 = undefined;\n          return _context2.abrupt(\"return\", {\n            gasPrice: _context2.t0,\n            maxPriorityFeePerGas: _context2.t1,\n            maxFeePerGas: _context2.t2\n          });\n        case 13:\n          if (!(transactionType === '0x2')) {\n            _context2.next = 20;\n            break;\n          }\n          _context2.t3 = Object;\n          _context2.t4 = {\n            gasPrice: undefined\n          };\n          _context2.next = 18;\n          return getEip1559GasPricing(transaction, web3Context, returnFormat);\n        case 18:\n          _context2.t5 = _context2.sent;\n          return _context2.abrupt(\"return\", _context2.t3.assign.call(_context2.t3, _context2.t4, _context2.t5));\n        case 20:\n          return _context2.abrupt(\"return\", undefined);\n        case 21:\n        case \"end\":\n          return _context2.stop();\n      }\n    }, _callee2);\n  }));\n}","map":{"version":3,"names":["isNullish","Eip1559NotSupportedError","UnsupportedTransactionTypeError","format","getBlock","getGasPrice","getTransactionType","getEip1559GasPricing","transaction","web3Context","returnFormat","defaultBlock","block","_context","sent","baseFeePerGas","next","gasPrice","convertedTransactionGasPrice","abrupt","maxPriorityFeePerGas","maxFeePerGas","_a","defaultMaxPriorityFeePerGas","_b","BigInt","_c","stop","_callee","getTransactionGasPricing","transactionType","_context2","startsWith","t0","t1","undefined","t2","t3","Object","t4","t5","assign","call","_callee2"],"sources":["D:\\projects\\react\\wen-base\\node_modules\\web3-eth\\src\\utils\\get_transaction_gas_pricing.ts"],"sourcesContent":["/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\n\nimport { Web3Context } from 'web3-core';\nimport {\n\tEthExecutionAPI,\n\tNumbers,\n\tTransaction,\n\tDataFormat,\n\tFormatType,\n\tETH_DATA_FORMAT,\n} from 'web3-types';\nimport { isNullish } from 'web3-validator';\nimport { Eip1559NotSupportedError, UnsupportedTransactionTypeError } from 'web3-errors';\nimport { format } from 'web3-utils';\n// eslint-disable-next-line import/no-cycle\nimport { getBlock, getGasPrice } from '../rpc_method_wrappers.js';\nimport { InternalTransaction } from '../types.js';\n// eslint-disable-next-line import/no-cycle\nimport { getTransactionType } from './transaction_builder.js';\n\nasync function getEip1559GasPricing<ReturnFormat extends DataFormat>(\n\ttransaction: FormatType<Transaction, typeof ETH_DATA_FORMAT>,\n\tweb3Context: Web3Context<EthExecutionAPI>,\n\treturnFormat: ReturnFormat,\n): Promise<FormatType<{ maxPriorityFeePerGas?: Numbers; maxFeePerGas?: Numbers }, ReturnFormat>> {\n\tconst block = await getBlock(web3Context, web3Context.defaultBlock, false, returnFormat);\n\n\tif (isNullish(block.baseFeePerGas)) throw new Eip1559NotSupportedError();\n\n\tif (!isNullish(transaction.gasPrice)) {\n\t\tconst convertedTransactionGasPrice = format(\n\t\t\t{ format: 'uint' },\n\t\t\ttransaction.gasPrice as Numbers,\n\t\t\treturnFormat,\n\t\t);\n\n\t\treturn {\n\t\t\tmaxPriorityFeePerGas: convertedTransactionGasPrice,\n\t\t\tmaxFeePerGas: convertedTransactionGasPrice,\n\t\t};\n\t}\n\treturn {\n\t\tmaxPriorityFeePerGas: format(\n\t\t\t{ format: 'uint' },\n\t\t\ttransaction.maxPriorityFeePerGas ?? web3Context.defaultMaxPriorityFeePerGas,\n\t\t\treturnFormat,\n\t\t),\n\t\tmaxFeePerGas: format(\n\t\t\t{ format: 'uint' },\n\t\t\t(transaction.maxFeePerGas ??\n\t\t\t\tBigInt(block.baseFeePerGas) * BigInt(2) +\n\t\t\t\t\tBigInt(\n\t\t\t\t\t\ttransaction.maxPriorityFeePerGas ?? web3Context.defaultMaxPriorityFeePerGas,\n\t\t\t\t\t)) as Numbers,\n\t\t\treturnFormat,\n\t\t),\n\t};\n}\n\nexport async function getTransactionGasPricing<ReturnFormat extends DataFormat>(\n\ttransaction: InternalTransaction,\n\tweb3Context: Web3Context<EthExecutionAPI>,\n\treturnFormat: ReturnFormat,\n): Promise<\n\t| FormatType<\n\t\t\t{ gasPrice?: Numbers; maxPriorityFeePerGas?: Numbers; maxFeePerGas?: Numbers },\n\t\t\tReturnFormat\n\t  >\n\t| undefined\n> {\n\tconst transactionType = getTransactionType(transaction, web3Context);\n\tif (!isNullish(transactionType)) {\n\t\tif (transactionType.startsWith('-'))\n\t\t\tthrow new UnsupportedTransactionTypeError(transactionType);\n\n\t\t// https://github.com/ethereum/EIPs/blob/master/EIPS/eip-2718.md#transactions\n\t\tif (transactionType < '0x0' || transactionType > '0x7f')\n\t\t\tthrow new UnsupportedTransactionTypeError(transactionType);\n\n\t\tif (\n\t\t\tisNullish(transaction.gasPrice) &&\n\t\t\t(transactionType === '0x0' || transactionType === '0x1')\n\t\t)\n\t\t\treturn {\n\t\t\t\tgasPrice: await getGasPrice(web3Context, returnFormat),\n\t\t\t\tmaxPriorityFeePerGas: undefined,\n\t\t\t\tmaxFeePerGas: undefined,\n\t\t\t};\n\n\t\tif (transactionType === '0x2') {\n\t\t\treturn {\n\t\t\t\tgasPrice: undefined,\n\t\t\t\t...(await getEip1559GasPricing(transaction, web3Context, returnFormat)),\n\t\t\t};\n\t\t}\n\t}\n\n\treturn undefined;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}