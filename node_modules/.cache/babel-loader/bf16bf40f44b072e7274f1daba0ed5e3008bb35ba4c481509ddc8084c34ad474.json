{"ast":null,"code":"import { bytesToHex } from 'web3-utils';\nimport { setLengthLeft, toUint8Array } from '../common/utils.js';\nimport { isAccessList } from './types.js';\nexport var checkMaxInitCodeSize = function checkMaxInitCodeSize(common, length) {\n  var maxInitCodeSize = common.param('vm', 'maxInitCodeSize');\n  if (maxInitCodeSize && BigInt(length) > maxInitCodeSize) {\n    throw new Error(\"the initcode size of this transaction is too large: it is \".concat(length, \" while the max is \").concat(common.param('vm', 'maxInitCodeSize')));\n  }\n};\nexport var getAccessListData = function getAccessListData(accessList) {\n  var AccessListJSON;\n  var uint8arrayAccessList;\n  if (isAccessList(accessList)) {\n    AccessListJSON = accessList;\n    var newAccessList = [];\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (var i = 0; i < accessList.length; i += 1) {\n      var item = accessList[i];\n      var addressBytes = toUint8Array(item.address);\n      var storageItems = [];\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (var index = 0; index < item.storageKeys.length; index += 1) {\n        storageItems.push(toUint8Array(item.storageKeys[index]));\n      }\n      newAccessList.push([addressBytes, storageItems]);\n    }\n    uint8arrayAccessList = newAccessList;\n  } else {\n    uint8arrayAccessList = accessList !== null && accessList !== void 0 ? accessList : [];\n    // build the JSON\n    var json = [];\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (var _i = 0; _i < uint8arrayAccessList.length; _i += 1) {\n      var data = uint8arrayAccessList[_i];\n      var address = bytesToHex(data[0]);\n      var storageKeys = [];\n      // eslint-disable-next-line @typescript-eslint/prefer-for-of\n      for (var _item = 0; _item < data[1].length; _item += 1) {\n        storageKeys.push(bytesToHex(data[1][_item]));\n      }\n      var jsonItem = {\n        address: address,\n        storageKeys: storageKeys\n      };\n      json.push(jsonItem);\n    }\n    AccessListJSON = json;\n  }\n  return {\n    AccessListJSON: AccessListJSON,\n    accessList: uint8arrayAccessList\n  };\n};\nexport var verifyAccessList = function verifyAccessList(accessList) {\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (var key = 0; key < accessList.length; key += 1) {\n    var accessListItem = accessList[key];\n    var address = accessListItem[0];\n    var storageSlots = accessListItem[1];\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n    if (accessListItem[2] !== undefined) {\n      throw new Error('Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.');\n    }\n    if (address.length !== 20) {\n      throw new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n    }\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (var storageSlot = 0; storageSlot < storageSlots.length; storageSlot += 1) {\n      if (storageSlots[storageSlot].length !== 32) {\n        throw new Error('Invalid EIP-2930 transaction: storage slot length should be 32 bytes');\n      }\n    }\n  }\n};\nexport var getAccessListJSON = function getAccessListJSON(accessList) {\n  var accessListJSON = [];\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (var index = 0; index < accessList.length; index += 1) {\n    var item = accessList[index];\n    var JSONItem = {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n      address: bytesToHex(setLengthLeft(item[0], 20)),\n      storageKeys: []\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n    var storageSlots = item && item[1];\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (var slot = 0; slot < storageSlots.length; slot += 1) {\n      var storageSlot = storageSlots[slot];\n      JSONItem.storageKeys.push(bytesToHex(setLengthLeft(storageSlot, 32)));\n    }\n    accessListJSON.push(JSONItem);\n  }\n  return accessListJSON;\n};\nexport var getDataFeeEIP2930 = function getDataFeeEIP2930(accessList, common) {\n  var accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n  var accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n  var slots = 0;\n  // eslint-disable-next-line @typescript-eslint/prefer-for-of\n  for (var index = 0; index < accessList.length; index += 1) {\n    var item = accessList[index];\n    var storageSlots = item[1];\n    slots += storageSlots.length;\n  }\n  var addresses = accessList.length;\n  return addresses * Number(accessListAddressCost) + slots * Number(accessListStorageKeyCost);\n};","map":{"version":3,"names":["bytesToHex","setLengthLeft","toUint8Array","isAccessList","checkMaxInitCodeSize","common","length","maxInitCodeSize","param","BigInt","Error","concat","getAccessListData","accessList","AccessListJSON","uint8arrayAccessList","newAccessList","i","item","addressBytes","address","storageItems","index","storageKeys","push","json","data","jsonItem","verifyAccessList","key","accessListItem","storageSlots","undefined","storageSlot","getAccessListJSON","accessListJSON","JSONItem","slot","getDataFeeEIP2930","accessListStorageKeyCost","accessListAddressCost","slots","addresses","Number"],"sources":["D:\\projects\\react\\wen-base\\node_modules\\web3-eth-accounts\\src\\tx\\utils.ts"],"sourcesContent":["/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nimport { HexString } from 'web3-types';\nimport { bytesToHex } from 'web3-utils';\nimport { setLengthLeft, toUint8Array } from '../common/utils.js';\nimport type { AccessList, AccessListUint8Array, AccessListItem } from './types.js';\nimport { isAccessList } from './types.js';\n\nimport type { Common } from '../common/common.js';\n\nexport const checkMaxInitCodeSize = (common: Common, length: number) => {\n\tconst maxInitCodeSize = common.param('vm', 'maxInitCodeSize');\n\tif (maxInitCodeSize && BigInt(length) > maxInitCodeSize) {\n\t\tthrow new Error(\n\t\t\t`the initcode size of this transaction is too large: it is ${length} while the max is ${common.param(\n\t\t\t\t'vm',\n\t\t\t\t'maxInitCodeSize',\n\t\t\t)}`,\n\t\t);\n\t}\n};\n\nexport const getAccessListData = (accessList: AccessListUint8Array | AccessList) => {\n\tlet AccessListJSON;\n\tlet uint8arrayAccessList;\n\tif (isAccessList(accessList)) {\n\t\tAccessListJSON = accessList;\n\t\tconst newAccessList: AccessListUint8Array = [];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let i = 0; i < accessList.length; i += 1) {\n\t\t\tconst item: AccessListItem = accessList[i];\n\t\t\tconst addressBytes = toUint8Array(item.address);\n\t\t\tconst storageItems: Uint8Array[] = [];\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\t\tfor (let index = 0; index < item.storageKeys.length; index += 1) {\n\t\t\t\tstorageItems.push(toUint8Array(item.storageKeys[index]));\n\t\t\t}\n\t\t\tnewAccessList.push([addressBytes, storageItems]);\n\t\t}\n\t\tuint8arrayAccessList = newAccessList;\n\t} else {\n\t\tuint8arrayAccessList = accessList ?? [];\n\t\t// build the JSON\n\t\tconst json: AccessList = [];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let i = 0; i < uint8arrayAccessList.length; i += 1) {\n\t\t\tconst data = uint8arrayAccessList[i];\n\t\t\tconst address = bytesToHex(data[0]);\n\t\t\tconst storageKeys: string[] = [];\n\t\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\t\tfor (let item = 0; item < data[1].length; item += 1) {\n\t\t\t\tstorageKeys.push(bytesToHex(data[1][item]));\n\t\t\t}\n\t\t\tconst jsonItem: AccessListItem = {\n\t\t\t\taddress,\n\t\t\t\tstorageKeys,\n\t\t\t};\n\t\t\tjson.push(jsonItem);\n\t\t}\n\t\tAccessListJSON = json;\n\t}\n\n\treturn {\n\t\tAccessListJSON,\n\t\taccessList: uint8arrayAccessList,\n\t};\n};\n\nexport const verifyAccessList = (accessList: AccessListUint8Array) => {\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let key = 0; key < accessList.length; key += 1) {\n\t\tconst accessListItem = accessList[key];\n\t\tconst address = accessListItem[0];\n\t\tconst storageSlots = accessListItem[1];\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\t\tif ((<any>accessListItem)[2] !== undefined) {\n\t\t\tthrow new Error(\n\t\t\t\t'Access list item cannot have 3 elements. It can only have an address, and an array of storage slots.',\n\t\t\t);\n\t\t}\n\t\tif (address.length !== 20) {\n\t\t\tthrow new Error('Invalid EIP-2930 transaction: address length should be 20 bytes');\n\t\t}\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let storageSlot = 0; storageSlot < storageSlots.length; storageSlot += 1) {\n\t\t\tif (storageSlots[storageSlot].length !== 32) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Invalid EIP-2930 transaction: storage slot length should be 32 bytes',\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n};\n\nexport const getAccessListJSON = (\n\taccessList: AccessListUint8Array,\n): {\n\taddress: HexString;\n\tstorageKeys: HexString[];\n}[] => {\n\tconst accessListJSON: { address: HexString; storageKeys: HexString[] }[] = [];\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let index = 0; index < accessList.length; index += 1) {\n\t\tconst item: any = accessList[index];\n\t\tconst JSONItem: { address: HexString; storageKeys: HexString[] } = {\n\t\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/consistent-type-assertions\n\t\t\taddress: bytesToHex(setLengthLeft(<Uint8Array>item[0], 20)),\n\t\t\tstorageKeys: [],\n\t\t};\n\t\t// eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, @typescript-eslint/prefer-optional-chain\n\t\tconst storageSlots: Uint8Array[] = item && item[1];\n\t\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\t\tfor (let slot = 0; slot < storageSlots.length; slot += 1) {\n\t\t\tconst storageSlot = storageSlots[slot];\n\t\t\tJSONItem.storageKeys.push(bytesToHex(setLengthLeft(storageSlot, 32)));\n\t\t}\n\t\taccessListJSON.push(JSONItem);\n\t}\n\treturn accessListJSON;\n};\n\nexport const getDataFeeEIP2930 = (accessList: AccessListUint8Array, common: Common): number => {\n\tconst accessListStorageKeyCost = common.param('gasPrices', 'accessListStorageKeyCost');\n\tconst accessListAddressCost = common.param('gasPrices', 'accessListAddressCost');\n\n\tlet slots = 0;\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let index = 0; index < accessList.length; index += 1) {\n\t\tconst item = accessList[index];\n\t\tconst storageSlots = item[1];\n\t\tslots += storageSlots.length;\n\t}\n\n\tconst addresses = accessList.length;\n\treturn addresses * Number(accessListAddressCost) + slots * Number(accessListStorageKeyCost);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}